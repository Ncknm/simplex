!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){var t,n=navigator.userAgent,a=/iphone/i.test(n),i=/chrome/i.test(n),r=/android/i.test(n);e.mask={definitions:{9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},e.fn.extend({caret:function(e,t){var n;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&(n=this.createTextRange(),n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(n=document.selection.createRange(),e=0-n.duplicate().moveStart("character",-1e5),t=e+n.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(n,o){var c,l,u,f,s,h,g,m;if(!n&&this.length>0){c=e(this[0]);var d=c.data(e.mask.dataName);return d?d():void 0}return o=e.extend({autoclear:e.mask.autoclear,placeholder:e.mask.placeholder,completed:null},o),l=e.mask.definitions,u=[],f=g=n.length,s=null,e.each(n.split(""),function(e,t){"?"==t?(g--,f=e):l[t]?(u.push(new RegExp(l[t])),null===s&&(s=u.length-1),f>e&&(h=u.length-1)):u.push(null)}),this.trigger("unmask").each(function(){function c(){if(o.completed){for(var e=s;h>=e;e++)if(u[e]&&C[e]===d(e))return;o.completed.call(w)}}function d(e){return o.placeholder.charAt(e<o.placeholder.length?e:0)}function p(e){for(;++e<g&&!u[e];);return e}function v(e){for(;--e>=0&&!u[e];);return e}function b(e,t){var n,a;if(!(0>e)){for(n=e,a=p(t);g>n;n++)if(u[n]){if(!(g>a&&u[n].test(C[a])))break;C[n]=C[a],C[a]=d(a),a=p(a)}A(),w.caret(Math.max(s,e))}}function k(e){var t,n,a,i;for(t=e,n=d(e);g>t;t++)if(u[t]){if(a=p(t),i=C[t],C[t]=n,!(g>a&&u[a].test(i)))break;n=i}}function y(){var e=w.val(),t=w.caret();if(m&&m.length&&m.length>e.length){for(T(!0);t.begin>0&&!u[t.begin-1];)t.begin--;if(0===t.begin)for(;t.begin<s&&!u[t.begin];)t.begin++;w.caret(t.begin,t.begin)}else{for(T(!0);t.begin<g&&!u[t.begin];)t.begin++;w.caret(t.begin,t.begin)}c()}function x(){T(),w.val()!=E&&w.change()}function j(e){if(!w.prop("readonly")){var t,n,i,r=e.which||e.keyCode;m=w.val(),8===r||46===r||a&&127===r?(t=w.caret(),n=t.begin,i=t.end,i-n===0&&(n=46!==r?v(n):i=p(n-1),i=46===r?p(i):i),S(n,i),b(n,i-1),e.preventDefault()):13===r?x.call(this,e):27===r&&(w.val(E),w.caret(0,T()),e.preventDefault())}}function R(t){if(!w.prop("readonly")){var n,a,i,o=t.which||t.keyCode,l=w.caret();if(!(t.ctrlKey||t.altKey||t.metaKey||32>o)&&o&&13!==o){if(l.end-l.begin!==0&&(S(l.begin,l.end),b(l.begin,l.end-1)),n=p(l.begin-1),g>n&&(a=String.fromCharCode(o),u[n].test(a))){if(k(n),C[n]=a,A(),i=p(n),r){var f=function(){e.proxy(e.fn.caret,w,i)()};setTimeout(f,0)}else w.caret(i);l.begin<=h&&c()}t.preventDefault()}}}function S(e,t){var n;for(n=e;t>n&&g>n;n++)u[n]&&(C[n]=d(n))}function A(){w.val(C.join(""))}function T(e){var t,n,a,i=w.val(),r=-1;for(t=0,a=0;g>t;t++)if(u[t]){for(C[t]=d(t);a++<i.length;)if(n=i.charAt(a-1),u[t].test(n)){C[t]=n,r=t;break}if(a>i.length){S(t+1,g);break}}else C[t]===i.charAt(a)&&a++,f>t&&(r=t);return e?A():f>r+1?o.autoclear||C.join("")===D?(w.val()&&w.val(""),S(0,g)):A():(A(),w.val(w.val().substring(0,r+1))),f?t:s}var w=e(this),C=e.map(n.split(""),function(e,t){return"?"!=e?l[e]?d(t):e:void 0}),D=C.join(""),E=w.val();w.data(e.mask.dataName,function(){return e.map(C,function(e,t){return u[t]&&e!=d(t)?e:null}).join("")}),w.one("unmask",function(){w.off(".mask").removeData(e.mask.dataName)}).on("focus.mask",function(){if(!w.prop("readonly")){clearTimeout(t);var e;E=w.val(),e=T(),t=setTimeout(function(){w.get(0)===document.activeElement&&(A(),e==n.replace("?","").length?w.caret(0,e):w.caret(e))},10)}}).on("blur.mask",x).on("keydown.mask",j).on("keypress.mask",R).on("input.mask paste.mask",function(){w.prop("readonly")||setTimeout(function(){var e=T(!0);w.caret(e),c()},0)}),i&&r&&w.off("input.mask").on("input.mask",y),T()})}})});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImpxdWVyeS5tYXNrZWRpbnB1dC5qcyJdLCJuYW1lcyI6WyJmYWN0b3J5IiwiZGVmaW5lIiwiYW1kIiwiZXhwb3J0cyIsInJlcXVpcmUiLCJqUXVlcnkiLCIkIiwiY2FyZXRUaW1lb3V0SWQiLCJ1YSIsIm5hdmlnYXRvciIsInVzZXJBZ2VudCIsImlQaG9uZSIsInRlc3QiLCJjaHJvbWUiLCJhbmRyb2lkIiwibWFzayIsImRlZmluaXRpb25zIiwiOSIsImEiLCIqIiwiYXV0b2NsZWFyIiwiZGF0YU5hbWUiLCJwbGFjZWhvbGRlciIsImZuIiwiZXh0ZW5kIiwiY2FyZXQiLCJiZWdpbiIsImVuZCIsInJhbmdlIiwidGhpcyIsImxlbmd0aCIsImlzIiwiZWFjaCIsInNldFNlbGVjdGlvblJhbmdlIiwiY3JlYXRlVGV4dFJhbmdlIiwiY29sbGFwc2UiLCJtb3ZlRW5kIiwibW92ZVN0YXJ0Iiwic2VsZWN0Iiwic2VsZWN0aW9uU3RhcnQiLCJzZWxlY3Rpb25FbmQiLCJkb2N1bWVudCIsInNlbGVjdGlvbiIsImNyZWF0ZVJhbmdlIiwiZHVwbGljYXRlIiwidGV4dCIsInVubWFzayIsInRyaWdnZXIiLCJzZXR0aW5ncyIsImlucHV0IiwiZGVmcyIsInRlc3RzIiwicGFydGlhbFBvc2l0aW9uIiwiZmlyc3ROb25NYXNrUG9zIiwibGFzdFJlcXVpcmVkTm9uTWFza1BvcyIsImxlbiIsIm9sZFZhbCIsImRhdGEiLCJjb21wbGV0ZWQiLCJzcGxpdCIsImkiLCJjIiwicHVzaCIsIlJlZ0V4cCIsInRyeUZpcmVDb21wbGV0ZWQiLCJidWZmZXIiLCJnZXRQbGFjZWhvbGRlciIsImNhbGwiLCJjaGFyQXQiLCJzZWVrTmV4dCIsInBvcyIsInNlZWtQcmV2Iiwic2hpZnRMIiwiaiIsIndyaXRlQnVmZmVyIiwiTWF0aCIsIm1heCIsInNoaWZ0UiIsInQiLCJhbmRyb2lkSW5wdXRFdmVudCIsImN1clZhbCIsInZhbCIsImNoZWNrVmFsIiwiYmx1ckV2ZW50IiwiZm9jdXNUZXh0IiwiY2hhbmdlIiwia2V5ZG93bkV2ZW50IiwiZSIsInByb3AiLCJrIiwid2hpY2giLCJrZXlDb2RlIiwiY2xlYXJCdWZmZXIiLCJwcmV2ZW50RGVmYXVsdCIsImtleXByZXNzRXZlbnQiLCJwIiwibmV4dCIsImN0cmxLZXkiLCJhbHRLZXkiLCJtZXRhS2V5IiwiU3RyaW5nIiwiZnJvbUNoYXJDb2RlIiwicHJveHkiLCJzZXRUaW1lb3V0Iiwic3RhcnQiLCJqb2luIiwiYWxsb3ciLCJsYXN0TWF0Y2giLCJkZWZhdWx0QnVmZmVyIiwic3Vic3RyaW5nIiwibWFwIiwib25lIiwib2ZmIiwicmVtb3ZlRGF0YSIsIm9uIiwiY2xlYXJUaW1lb3V0IiwiZ2V0IiwiYWN0aXZlRWxlbWVudCIsInJlcGxhY2UiXSwibWFwcGluZ3MiOiJDQU1DLFNBQVNBLEdBQ04sa0JBQXFCQyxTQUFVQSxPQUFPQyxJQUFNRCxRQUFTLFVBQVlELEdBQVdBLEVBQVEsZ0JBQW1CRyxTQUFVQyxRQUFRLFVBQVlDLFNBQ3ZJLFNBQVNDLEdBQ1AsR0FBSUMsR0FBZ0JDLEVBQUtDLFVBQVVDLFVBQVdDLEVBQVMsVUFBVUMsS0FBS0osR0FBS0ssRUFBUyxVQUFVRCxLQUFLSixHQUFLTSxFQUFVLFdBQVdGLEtBQUtKLEVBQ2xJRixHQUFFUyxNQUNFQyxhQUNJQyxFQUFLLFFBQ0xDLEVBQUcsV0FDSEMsSUFBSyxlQUVUQyxXQUFXLEVBQ1hDLFNBQVUsWUFDVkMsWUFBYSxLQUNkaEIsRUFBRWlCLEdBQUdDLFFBQ0pDLE1BQU8sU0FBU0MsRUFBT0MsR0FDbkIsR0FBSUMsRUFDSixJQUFJLElBQU1DLEtBQUtDLFNBQVdELEtBQUtFLEdBQUcsV0FBWSxNQUFPLGdCQUFtQkwsSUFBU0MsRUFBTSxnQkFBbUJBLEdBQU1BLEVBQU1ELEVBQ3RIRyxLQUFLRyxLQUFLLFdBQ05ILEtBQUtJLGtCQUFvQkosS0FBS0ksa0JBQWtCUCxFQUFPQyxHQUFPRSxLQUFLSyxrQkFBb0JOLEVBQVFDLEtBQUtLLGtCQUNwR04sRUFBTU8sVUFBUyxHQUFLUCxFQUFNUSxRQUFR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QU1nQyxLQUN2RGhDLEdBQU1RLEtBQUtuRCxFQUFFUyxLQUFLTSxTQUFVLFdBQ3hCLE1BQU9mLEdBQUV3RyxJQUFJN0MsRUFBUSxTQUFTSixFQUFHRCxHQUM3QixNQUFPVCxHQUFNUyxJQUFNQyxHQUFLSyxFQUFlTixHQUFLQyxFQUFJLE9BQ2pENEMsS0FBSyxNQUNSeEQsRUFBTThELElBQUksU0FBVSxXQUNwQjlELEVBQU0rRCxJQUFJLFNBQVNDLFdBQVczRyxFQUFFUyxLQUFLTSxZQUN0QzZGLEdBQUcsYUFBYyxXQUNoQixJQUFLakUsRUFBTXVDLEtBQUssWUFBYSxDQUN6QjJCLGFBQWE1RyxFQUNiLElBQUkrRCxFQUNKYyxHQUFZbkMsRUFBTWdDLE1BQU9YLEVBQU1ZLElBQVkzRSxFQUFpQmdHLFdBQVcsV0FDbkV0RCxFQUFNbUUsSUFBSSxLQUFPM0UsU0FBUzRFLGdCQUFrQjNDLElBQWVKLEdBQU92RCxFQUFLdUcsUUFBUSxJQUFLLElBQUl4RixPQUFTbUIsRUFBTXhCLE1BQU0sRUFBRzZDLEdBQU9yQixFQUFNeEIsTUFBTTZDLEtBQ3BJLE9BRVI0QyxHQUFHLFlBQWEvQixHQUFXK0IsR0FBRyxlQUFnQjVCLEdBQWM0QixHQUFHLGdCQUFpQnBCLEdBQWVvQixHQUFHLHdCQUF5QixXQUMxSGpFLEVBQU11QyxLQUFLLGFBQWVlLFdBQVcsV0FDakMsR0FBSWpDLEdBQU1ZLEdBQVMsRUFDbkJqQyxHQUFNeEIsTUFBTTZDLEdBQU1OLEtBQ25CLEtBQ0huRCxHQUFVQyxHQUFXbUMsRUFBTStELElBQUksY0FBY0UsR0FBRyxhQUFjbkMsR0FDbEVHIiwiZmlsZSI6ImpxdWVyeS5tYXNrZWRpbnB1dC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gICAgalF1ZXJ5IE1hc2tlZCBJbnB1dCBQbHVnaW5cbiAgICBDb3B5cmlnaHQgKGMpIDIwMDcgLSAyMDE1IEpvc2ggQnVzaCAoZGlnaXRhbGJ1c2guY29tKVxuICAgIExpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSAoaHR0cDovL2RpZ2l0YWxidXNoLmNvbS9wcm9qZWN0cy9tYXNrZWQtaW5wdXQtcGx1Z2luLyNsaWNlbnNlKVxuICAgIFZlcnNpb246IDEuNC4xXG4qL1xuIWZ1bmN0aW9uKGZhY3RvcnkpIHtcbiAgICBcImZ1bmN0aW9uXCIgPT0gdHlwZW9mIGRlZmluZSAmJiBkZWZpbmUuYW1kID8gZGVmaW5lKFsgXCJqcXVlcnlcIiBdLCBmYWN0b3J5KSA6IGZhY3RvcnkoXCJvYmplY3RcIiA9PSB0eXBlb2YgZXhwb3J0cyA/IHJlcXVpcmUoXCJqcXVlcnlcIikgOiBqUXVlcnkpO1xufShmdW5jdGlvbigkKSB7XG4gICAgdmFyIGNhcmV0VGltZW91dElkLCB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQsIGlQaG9uZSA9IC9pcGhvbmUvaS50ZXN0KHVhKSwgY2hyb21lID0gL2Nocm9tZS9pLnRlc3QodWEpLCBhbmRyb2lkID0gL2FuZHJvaWQvaS50ZXN0KHVhKTtcbiAgICAkLm1hc2sgPSB7XG4gICAgICAgIGRlZmluaXRpb25zOiB7XG4gICAgICAgICAgICBcIjlcIjogXCJbMC05XVwiLFxuICAgICAgICAgICAgYTogXCJbQS1aYS16XVwiLFxuICAgICAgICAgICAgXCIqXCI6IFwiW0EtWmEtejAtOV1cIlxuICAgICAgICB9LFxuICAgICAgICBhdXRvY2xlYXI6ICEwLFxuICAgICAgICBkYXRhTmFtZTogXCJyYXdNYXNrRm5cIixcbiAgICAgICAgcGxhY2Vob2xkZXI6IFwiX1wiXG4gICAgfSwgJC5mbi5leHRlbmQoe1xuICAgICAgICBjYXJldDogZnVuY3Rpb24oYmVnaW4sIGVuZCkge1xuICAgICAgICAgICAgdmFyIHJhbmdlO1xuICAgICAgICAgICAgaWYgKDAgIT09IHRoaXMubGVuZ3RoICYmICF0aGlzLmlzKFwiOmhpZGRlblwiKSkgcmV0dXJuIFwibnVtYmVyXCIgPT0gdHlwZW9mIGJlZ2luID8gKGVuZCA9IFwibnVtYmVyXCIgPT0gdHlwZW9mIGVuZCA/IGVuZCA6IGJlZ2luLCBcbiAgICAgICAgICAgIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNldFNlbGVjdGlvblJhbmdlID8gdGhpcy5zZXRTZWxlY3Rpb25SYW5nZShiZWdpbiwgZW5kKSA6IHRoaXMuY3JlYXRlVGV4dFJhbmdlICYmIChyYW5nZSA9IHRoaXMuY3JlYXRlVGV4dFJhbmdlKCksIFxuICAgICAgICAgICAgICAgIHJhbmdlLmNvbGxhcHNlKCEwKSwgcmFuZ2UubW92ZUVuZChcImNoYXJhY3RlclwiLCBlbmQpLCByYW5nZS5tb3ZlU3RhcnQoXCJjaGFyYWN0ZXJcIiwgYmVnaW4pLCBcbiAgICAgICAgICAgICAgICByYW5nZS5zZWxlY3QoKSk7XG4gICAgICAgICAgICB9KSkgOiAodGhpc1swXS5zZXRTZWxlY3Rpb25SYW5nZSA/IChiZWdpbiA9IHRoaXNbMF0uc2VsZWN0aW9uU3RhcnQsIGVuZCA9IHRoaXNbMF0uc2VsZWN0aW9uRW5kKSA6IGRvY3VtZW50LnNlbGVjdGlvbiAmJiBkb2N1bWVudC5zZWxlY3Rpb24uY3JlYXRlUmFuZ2UgJiYgKHJhbmdlID0gZG9jdW1lbnQuc2VsZWN0aW9uLmNyZWF0ZVJhbmdlKCksIFxuICAgICAgICAgICAgYmVnaW4gPSAwIC0gcmFuZ2UuZHVwbGljYXRlKCkubW92ZVN0YXJ0KFwiY2hhcmFjdGVyXCIsIC0xZTUpLCBlbmQgPSBiZWdpbiArIHJhbmdlLnRleHQubGVuZ3RoKSwgXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYmVnaW46IGJlZ2luLFxuICAgICAgICAgICAgICAgIGVuZDogZW5kXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgdW5tYXNrOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoXCJ1bm1hc2tcIik7XG4gICAgICAgIH0sXG4gICAgICAgIG1hc2s6IGZ1bmN0aW9uKG1hc2ssIHNldHRpbmdzKSB7XG4gICAgICAgICAgICB2YXIgaW5wdXQsIGRlZnMsIHRlc3RzLCBwYXJ0aWFsUG9zaXRpb24sIGZpcnN0Tm9uTWFza1BvcywgbGFzdFJlcXVpcmVkTm9uTWFza1BvcywgbGVuLCBvbGRWYWw7XG4gICAgICAgICAgICBpZiAoIW1hc2sgJiYgdGhpcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaW5wdXQgPSAkKHRoaXNbMF0pO1xuICAgICAgICAgICAgICAgIHZhciBmbiA9IGlucHV0LmRhdGEoJC5tYXNrLmRhdGFOYW1lKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZm4gPyBmbigpIDogdm9pZCAwO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHNldHRpbmdzID0gJC5leHRlbmQoe1xuICAgICAgICAgICAgICAgIGF1dG9jbGVhcjogJC5tYXNrLmF1dG9jbGVhcixcbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcjogJC5tYXNrLnBsYWNlaG9sZGVyLFxuICAgICAgICAgICAgICAgIGNvbXBsZXRlZDogbnVsbFxuICAgICAgICAgICAgfSwgc2V0dGluZ3MpLCBkZWZzID0gJC5tYXNrLmRlZmluaXRpb25zLCB0ZXN0cyA9IFtdLCBwYXJ0aWFsUG9zaXRpb24gPSBsZW4gPSBtYXNrLmxlbmd0aCwgXG4gICAgICAgICAgICBmaXJzdE5vbk1hc2tQb3MgPSBudWxsLCAkLmVhY2gobWFzay5zcGxpdChcIlwiKSwgZnVuY3Rpb24oaSwgYykge1xuICAgICAgICAgICAgICAgIFwiP1wiID09IGMgPyAobGVuLS0sIHBhcnRpYWxQb3NpdGlvbiA9IGkpIDogZGVmc1tjXSA/ICh0ZXN0cy5wdXNoKG5ldyBSZWdFeHAoZGVmc1tjXSkpLCBcbiAgICAgICAgICAgICAgICBudWxsID09PSBmaXJzdE5vbk1hc2tQb3MgJiYgKGZpcnN0Tm9uTWFza1BvcyA9IHRlc3RzLmxlbmd0aCAtIDEpLCBwYXJ0aWFsUG9zaXRpb24gPiBpICYmIChsYXN0UmVxdWlyZWROb25NYXNrUG9zID0gdGVzdHMubGVuZ3RoIC0gMSkpIDogdGVzdHMucHVzaChudWxsKTtcbiAgICAgICAgICAgIH0pLCB0aGlzLnRyaWdnZXIoXCJ1bm1hc2tcIikuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiB0cnlGaXJlQ29tcGxldGVkKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoc2V0dGluZ3MuY29tcGxldGVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gZmlyc3ROb25NYXNrUG9zOyBsYXN0UmVxdWlyZWROb25NYXNrUG9zID49IGk7IGkrKykgaWYgKHRlc3RzW2ldICYmIGJ1ZmZlcltpXSA9PT0gZ2V0UGxhY2Vob2xkZXIoaSkpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldHRpbmdzLmNvbXBsZXRlZC5jYWxsKGlucHV0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBnZXRQbGFjZWhvbGRlcihpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXR0aW5ncy5wbGFjZWhvbGRlci5jaGFyQXQoaSA8IHNldHRpbmdzLnBsYWNlaG9sZGVyLmxlbmd0aCA/IGkgOiAwKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gc2Vla05leHQocG9zKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoOysrcG9zIDwgbGVuICYmICF0ZXN0c1twb3NdOyApIDtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHBvcztcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gc2Vla1ByZXYocG9zKSB7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoOy0tcG9zID49IDAgJiYgIXRlc3RzW3Bvc107ICkgO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcG9zO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBzaGlmdEwoYmVnaW4sIGVuZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSwgajtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCEoMCA+IGJlZ2luKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gYmVnaW4sIGogPSBzZWVrTmV4dChlbmQpOyBsZW4gPiBpOyBpKyspIGlmICh0ZXN0c1tpXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghKGxlbiA+IGogJiYgdGVzdHNbaV0udGVzdChidWZmZXJbal0pKSkgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyW2ldID0gYnVmZmVyW2pdLCBidWZmZXJbal0gPSBnZXRQbGFjZWhvbGRlcihqKSwgaiA9IHNlZWtOZXh0KGopO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgd3JpdGVCdWZmZXIoKSwgaW5wdXQuY2FyZXQoTWF0aC5tYXgoZmlyc3ROb25NYXNrUG9zLCBiZWdpbikpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIHNoaWZ0Uihwb3MpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGksIGMsIGosIHQ7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IHBvcywgYyA9IGdldFBsYWNlaG9sZGVyKHBvcyk7IGxlbiA+IGk7IGkrKykgaWYgKHRlc3RzW2ldKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA9IHNlZWtOZXh0KGkpLCB0ID0gYnVmZmVyW2ldLCBidWZmZXJbaV0gPSBjLCAhKGxlbiA+IGogJiYgdGVzdHNbal0udGVzdCh0KSkpIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgYyA9IHQ7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gYW5kcm9pZElucHV0RXZlbnQoKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjdXJWYWwgPSBpbnB1dC52YWwoKSwgcG9zID0gaW5wdXQuY2FyZXQoKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9sZFZhbCAmJiBvbGRWYWwubGVuZ3RoICYmIG9sZFZhbC5sZW5ndGggPiBjdXJWYWwubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNoZWNrVmFsKCEwKTsgcG9zLmJlZ2luID4gMCAmJiAhdGVzdHNbcG9zLmJlZ2luIC0gMV07ICkgcG9zLmJlZ2luLS07XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PT0gcG9zLmJlZ2luKSBmb3IgKDtwb3MuYmVnaW4gPCBmaXJzdE5vbk1hc2tQb3MgJiYgIXRlc3RzW3Bvcy5iZWdpbl07ICkgcG9zLmJlZ2luKys7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jYXJldChwb3MuYmVnaW4sIHBvcy5iZWdpbik7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNoZWNrVmFsKCEwKTsgcG9zLmJlZ2luIDwgbGVuICYmICF0ZXN0c1twb3MuYmVnaW5dOyApIHBvcy5iZWdpbisrO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2FyZXQocG9zLmJlZ2luLCBwb3MuYmVnaW4pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRyeUZpcmVDb21wbGV0ZWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gYmx1ckV2ZW50KCkge1xuICAgICAgICAgICAgICAgICAgICBjaGVja1ZhbCgpLCBpbnB1dC52YWwoKSAhPSBmb2N1c1RleHQgJiYgaW5wdXQuY2hhbmdlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIGtleWRvd25FdmVudChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghaW5wdXQucHJvcChcInJlYWRvbmx5XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zLCBiZWdpbiwgZW5kLCBrID0gZS53aGljaCB8fCBlLmtleUNvZGU7XG4gICAgICAgICAgICAgICAgICAgICAgICBvbGRWYWwgPSBpbnB1dC52YWwoKSwgOCA9PT0gayB8fCA0NiA9PT0gayB8fCBpUGhvbmUgJiYgMTI3ID09PSBrID8gKHBvcyA9IGlucHV0LmNhcmV0KCksIFxuICAgICAgICAgICAgICAgICAgICAgICAgYmVnaW4gPSBwb3MuYmVnaW4sIGVuZCA9IHBvcy5lbmQsIGVuZCAtIGJlZ2luID09PSAwICYmIChiZWdpbiA9IDQ2ICE9PSBrID8gc2Vla1ByZXYoYmVnaW4pIDogZW5kID0gc2Vla05leHQoYmVnaW4gLSAxKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmQgPSA0NiA9PT0gayA/IHNlZWtOZXh0KGVuZCkgOiBlbmQpLCBjbGVhckJ1ZmZlcihiZWdpbiwgZW5kKSwgc2hpZnRMKGJlZ2luLCBlbmQgLSAxKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCkpIDogMTMgPT09IGsgPyBibHVyRXZlbnQuY2FsbCh0aGlzLCBlKSA6IDI3ID09PSBrICYmIChpbnB1dC52YWwoZm9jdXNUZXh0KSwgXG4gICAgICAgICAgICAgICAgICAgICAgICBpbnB1dC5jYXJldCgwLCBjaGVja1ZhbCgpKSwgZS5wcmV2ZW50RGVmYXVsdCgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiBrZXlwcmVzc0V2ZW50KGUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFpbnB1dC5wcm9wKFwicmVhZG9ubHlcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwLCBjLCBuZXh0LCBrID0gZS53aGljaCB8fCBlLmtleUNvZGUsIHBvcyA9IGlucHV0LmNhcmV0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIShlLmN0cmxLZXkgfHwgZS5hbHRLZXkgfHwgZS5tZXRhS2V5IHx8IDMyID4gaykgJiYgayAmJiAxMyAhPT0gaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3MuZW5kIC0gcG9zLmJlZ2luICE9PSAwICYmIChjbGVhckJ1ZmZlcihwb3MuYmVnaW4sIHBvcy5lbmQpLCBzaGlmdEwocG9zLmJlZ2luLCBwb3MuZW5kIC0gMSkpLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwID0gc2Vla05leHQocG9zLmJlZ2luIC0gMSksIGxlbiA+IHAgJiYgKGMgPSBTdHJpbmcuZnJvbUNoYXJDb2RlKGspLCB0ZXN0c1twXS50ZXN0KGMpKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2hpZnRSKHApLCBidWZmZXJbcF0gPSBjLCB3cml0ZUJ1ZmZlcigpLCBuZXh0ID0gc2Vla05leHQocCksIGFuZHJvaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcm94eSA9IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQucHJveHkoJC5mbi5jYXJldCwgaW5wdXQsIG5leHQpKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2V0VGltZW91dChwcm94eSwgMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpbnB1dC5jYXJldChuZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcG9zLmJlZ2luIDw9IGxhc3RSZXF1aXJlZE5vbk1hc2tQb3MgJiYgdHJ5RmlyZUNvbXBsZXRlZCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY2xlYXJCdWZmZXIoc3RhcnQsIGVuZCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gc3RhcnQ7IGVuZCA+IGkgJiYgbGVuID4gaTsgaSsrKSB0ZXN0c1tpXSAmJiAoYnVmZmVyW2ldID0gZ2V0UGxhY2Vob2xkZXIoaSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBmdW5jdGlvbiB3cml0ZUJ1ZmZlcigpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQudmFsKGJ1ZmZlci5qb2luKFwiXCIpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gY2hlY2tWYWwoYWxsb3cpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGksIGMsIHBvcywgdGVzdCA9IGlucHV0LnZhbCgpLCBsYXN0TWF0Y2ggPSAtMTtcbiAgICAgICAgICAgICAgICAgICAgZm9yIChpID0gMCwgcG9zID0gMDsgbGVuID4gaTsgaSsrKSBpZiAodGVzdHNbaV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvciAoYnVmZmVyW2ldID0gZ2V0UGxhY2Vob2xkZXIoaSk7IHBvcysrIDwgdGVzdC5sZW5ndGg7ICkgaWYgKGMgPSB0ZXN0LmNoYXJBdChwb3MgLSAxKSwgXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXN0c1tpXS50ZXN0KGMpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnVmZmVyW2ldID0gYywgbGFzdE1hdGNoID0gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwb3MgPiB0ZXN0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsZWFyQnVmZmVyKGkgKyAxLCBsZW4pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9IGVsc2UgYnVmZmVyW2ldID09PSB0ZXN0LmNoYXJBdChwb3MpICYmIHBvcysrLCBwYXJ0aWFsUG9zaXRpb24gPiBpICYmIChsYXN0TWF0Y2ggPSBpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGFsbG93ID8gd3JpdGVCdWZmZXIoKSA6IHBhcnRpYWxQb3NpdGlvbiA+IGxhc3RNYXRjaCArIDEgPyBzZXR0aW5ncy5hdXRvY2xlYXIgfHwgYnVmZmVyLmpvaW4oXCJcIikgPT09IGRlZmF1bHRCdWZmZXIgPyAoaW5wdXQudmFsKCkgJiYgaW5wdXQudmFsKFwiXCIpLCBcbiAgICAgICAgICAgICAgICAgICAgY2xlYXJCdWZmZXIoMCwgbGVuKSkgOiB3cml0ZUJ1ZmZlcigpIDogKHdyaXRlQnVmZmVyKCksIGlucHV0LnZhbChpbnB1dC52YWwoKS5zdWJzdHJpbmcoMCwgbGFzdE1hdGNoICsgMSkpKSwgXG4gICAgICAgICAgICAgICAgICAgIHBhcnRpYWxQb3NpdGlvbiA/IGkgOiBmaXJzdE5vbk1hc2tQb3M7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciBpbnB1dCA9ICQodGhpcyksIGJ1ZmZlciA9ICQubWFwKG1hc2suc3BsaXQoXCJcIiksIGZ1bmN0aW9uKGMsIGkpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFwiP1wiICE9IGMgPyBkZWZzW2NdID8gZ2V0UGxhY2Vob2xkZXIoaSkgOiBjIDogdm9pZCAwO1xuICAgICAgICAgICAgICAgIH0pLCBkZWZhdWx0QnVmZmVyID0gYnVmZmVyLmpvaW4oXCJcIiksIGZvY3VzVGV4dCA9IGlucHV0LnZhbCgpO1xuICAgICAgICAgICAgICAgIGlucHV0LmRhdGEoJC5tYXNrLmRhdGFOYW1lLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuICQubWFwKGJ1ZmZlciwgZnVuY3Rpb24oYywgaSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRlc3RzW2ldICYmIGMgIT0gZ2V0UGxhY2Vob2xkZXIoaSkgPyBjIDogbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSkuam9pbihcIlwiKTtcbiAgICAgICAgICAgICAgICB9KSwgaW5wdXQub25lKFwidW5tYXNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpbnB1dC5vZmYoXCIubWFza1wiKS5yZW1vdmVEYXRhKCQubWFzay5kYXRhTmFtZSk7XG4gICAgICAgICAgICAgICAgfSkub24oXCJmb2N1cy5tYXNrXCIsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoIWlucHV0LnByb3AoXCJyZWFkb25seVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJUaW1lb3V0KGNhcmV0VGltZW91dElkKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwb3M7XG4gICAgICAgICAgICAgICAgICAgICAgICBmb2N1c1RleHQgPSBpbnB1dC52YWwoKSwgcG9zID0gY2hlY2tWYWwoKSwgY2FyZXRUaW1lb3V0SWQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0LmdldCgwKSA9PT0gZG9jdW1lbnQuYWN0aXZlRWxlbWVudCAmJiAod3JpdGVCdWZmZXIoKSwgcG9zID09IG1hc2sucmVwbGFjZShcIj9cIiwgXCJcIikubGVuZ3RoID8gaW5wdXQuY2FyZXQoMCwgcG9zKSA6IGlucHV0LmNhcmV0KHBvcykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSwgMTApO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSkub24oXCJibHVyLm1hc2tcIiwgYmx1ckV2ZW50KS5vbihcImtleWRvd24ubWFza1wiLCBrZXlkb3duRXZlbnQpLm9uKFwia2V5cHJlc3MubWFza1wiLCBrZXlwcmVzc0V2ZW50KS5vbihcImlucHV0Lm1hc2sgcGFzdGUubWFza1wiLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5wdXQucHJvcChcInJlYWRvbmx5XCIpIHx8IHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcG9zID0gY2hlY2tWYWwoITApO1xuICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQuY2FyZXQocG9zKSwgdHJ5RmlyZUNvbXBsZXRlZCgpO1xuICAgICAgICAgICAgICAgICAgICB9LCAwKTtcbiAgICAgICAgICAgICAgICB9KSwgY2hyb21lICYmIGFuZHJvaWQgJiYgaW5wdXQub2ZmKFwiaW5wdXQubWFza1wiKS5vbihcImlucHV0Lm1hc2tcIiwgYW5kcm9pZElucHV0RXZlbnQpLCBcbiAgICAgICAgICAgICAgICBjaGVja1ZhbCgpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbn0pOyJdfQ==
